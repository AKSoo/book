.. _hirni:

DataLad for Hirnis
==================

Neuroimaging studies that use data acquired with
`functional magnetic resonance imaging (fMRI) <https://en.wikipedia.org/wiki/Functional_magnetic_resonance_imaging>`_
have complex :term:`provenance`. Over the course of the study, the
data usually undergoes several transformations. From the standardized medical
imaging data formats (usually `DICOM <https://en.wikipedia.org/wiki/DICOM>`_ files)
and directory structures that are produced by the MRI scanner (usually
*acquisition*-wise archives), the data is

- converted to file types used for scientific analyses (usually
  `NIfTI <https://nifti.nimh.nih.gov/nifti-1/documentation/hbm_nifti_2004.pdf>`_),
- joined with other acquired data such as physiological or behavioral measures,
  renamed and structured into an data collection to ease data analysis and data sharing, and
- (pre)processed, analyzed, and aggregated into the results of the study.

Usually, the main focus for provenance capture and reproducibility lies on the
analysis aspects of a study. But the **input** of the analysis stems from the
conversion from raw data into usable formats and directory structures. This is a
complex, non-trivial, and multi-stepped process: It requires the
use of specialized software or custom scripts, is especially difficult if there
are complex study protocols or additional data types to consider, and regularly does
not include considerations for provenance capture or reproducibility. Often, conversion
and restructuring are done "by hand" in successive, unconnected steps.
This makes it difficult to retrace the series of steps that were done to get
raw DICOMs and other study data into an analyzable format and structure.
Scripts, software, and raw data used for creating the final analysis dataset
are often kept in a different location than where the analysis dataset ends up.
Thus, the analysis dataset, structured and converted for further processing,
is disconnected from its source.
These complexities make the very first, fundamental aspect of a neuroimaging study
tedious, intransparent, and potentially irreproducible. It can be a frustrating,
time consuming process, and it can be difficult to reconstruct what was done,
redo the process, or repeat it with slight alterations, such as a changed file
naming scheme.

DataLad Hirni
^^^^^^^^^^^^^

``datalad hirni`` [#f1]_ is a **neuroimaging** specific :term:`Datalad extension` [#f2]_.
What it adds to the version control and dataset linkage capabilities of DataLad is a fully
provenance-tracked, web-client assisted, meta-data driven conversion of raw
DICOM data into NifTI format, with data structuring and renaming that
complies to standards such as `BIDS <https://bids.neuroimaging.io/>`_ .

In conjunction, DataLad and ``hirni`` can bind
and structure all parts of a neuroimaging study together: (Raw) data, metadata,
code, and computational environments. If used correctly, these two tools allow
to create completely provenance-captured neuroimaging studies -- from the
acquisition of the raw data and conversion and data structuring, up to the
analysis -- as version controlled and linked DataLad datasets.
This allows a full traceback from an analysis-ready study dataset to the raw
acquisition data, and, importantly, allows to redo the conversion automatically
or adjust it to new standards.

This chapter steps through the basics of the process of creating an entirely
provenance-captured study: How one gets from the raw data from an MRI scanner to
a converted, structured DataLad dataset in a reproducible fashion, and subsequently
use this dataset for analyses.
The fundamental process is outlined below, and the upcoming sections demonstrate
the process in detail.

.. figure:: ../artwork/src/hirni_overview.svg
   :alt: A conceptual overview of DataLad hirni
   :align: left

   The rightmost analysis dataset originated from a complex sequence of steps:
   An MRI scanner acquired imaging data and deposited them in a scanner data base
   (lower left). DICOM and other acquired data were imported into a collection
   of data from the study, the study dataset, produced by ``hirni``.
   Based on the study dataset, a meta-data driven, semi-automatic conversion to
   directory structure and naming standards (such as BIDS) is performed.
   This process is fully provenance-captured and reproducible: Code, software,
   inputs, and conversion rules are captured as :term:`run record`\s.
   Converted and restructured study data as well as extracted meta data becomes
   the foundation of the analysis dataset. As all of the components of this process
   are linked DataLad datasets, it is possible to trace back from the analysis
   result to the raw data.


.. rubric:: Footnotes

.. [#f1] "What's the name?" you may be asking yourself. Hirni is a German word-play.
         It's derived from the German word for brain ("Hirn"), and is slang for
         "idiot".
.. [#f2] As all :term:`DataLad extension`\s, ``datalad-hirni`` comes as a pip-installable
         Python package::

            $ pip install datalad-hirni
